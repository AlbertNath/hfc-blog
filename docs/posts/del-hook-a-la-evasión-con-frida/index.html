<!DOCTYPE html>
<html lang="es">
<head>
  
    <title>Del hook a la evasión con Frida :: Hackers Fight Club Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=" Contexto: Este artículo habla sobre el uso de la herramienta Frida, utilizada para pruebas de penetración en entornos móviles como Android y iOS, su objetivo es enseñar a realizar scripts propios evitando depender de los ya existentes.
Preparando el entorno Para poder realizar nuestros ejercicios con frida, es necesario subir un binario de frida server que será el que nos permitirá hookear procesos. Es necesario que el dispositivo esté rooteado, por lo que basta con utilizar algun AVD que no tenga la API de Google Play, o uno rooteado con aplicaciones como Magisk y RootAVD.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://albertnath.github.io/hfc-blog/posts/del-hook-a-la-evasi%C3%B3n-con-frida/" />





  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/code.min.4f0ccc8439f99bf7f7970298556b94011aabc1fcae743b6842fc3361a2da9ea3.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/main.min.61ebeff97afe3635753dcda5e0c7a822cb4d2ca9a4e662b6736ffb5a39b2f99a.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://albertnath.github.io/hfc-blog/terminal.css">




<link rel="shortcut icon" href="https://albertnath.github.io/hfc-blog/favicon.png">
<link rel="apple-touch-icon" href="https://albertnath.github.io/hfc-blog/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Lorne" />



<meta property="og:locale" content="es" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Del hook a la evasión con Frida">
<meta property="og:description" content=" Contexto: Este artículo habla sobre el uso de la herramienta Frida, utilizada para pruebas de penetración en entornos móviles como Android y iOS, su objetivo es enseñar a realizar scripts propios evitando depender de los ya existentes.
Preparando el entorno Para poder realizar nuestros ejercicios con frida, es necesario subir un binario de frida server que será el que nos permitirá hookear procesos. Es necesario que el dispositivo esté rooteado, por lo que basta con utilizar algun AVD que no tenga la API de Google Play, o uno rooteado con aplicaciones como Magisk y RootAVD.
" />
<meta property="og:url" content="https://albertnath.github.io/hfc-blog/posts/del-hook-a-la-evasi%C3%B3n-con-frida/" />
<meta property="og:site_name" content="Hackers Fight Club Blog" />

  <meta property="og:image" content="https://albertnath.github.io/hfc-blog/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-08-07 20:27:25 -0600 CST" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://albertnath.github.io/hfc-blog/">
  <div class="logo">
    Hackers Fight Club Blog
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/acerca-de">Acerca De</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/authors">Autores</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/tags">Categorías</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/posts">Posts</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/acerca-de" >Acerca De</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/authors" >Autores</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/tags" >Categorías</a></li>
        
      
        
          <li><a href="https://albertnath.github.io/hfc-blog/posts" >Posts</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://albertnath.github.io/hfc-blog/posts/del-hook-a-la-evasi%C3%B3n-con-frida/">Del hook a la evasión con Frida</a>
  </h1>
  <div class="post-meta"><time class="post-date">07-08-2025</time><span class="post-author">Lorne</span><span class="post-reading-time">8 min. de lectura (1496 palabras)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://albertnath.github.io/hfc-blog/tags/mobile/">Mobile</a>&nbsp;
      
      #<a href="https://albertnath.github.io/hfc-blog/tags/android/">Android</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <blockquote>
<p>Contexto: Este artículo habla sobre el uso de la herramienta Frida, utilizada para pruebas de penetración en entornos móviles como Android y iOS, su objetivo es enseñar a realizar scripts propios evitando depender de los ya existentes.</p></blockquote>
<h2 id="preparando-el-entorno">Preparando el entorno<a href="#preparando-el-entorno" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Para poder realizar nuestros ejercicios con frida, es necesario subir un binario de frida server que será el que nos permitirá hookear procesos. Es necesario que el dispositivo esté rooteado, por lo que basta con utilizar algun AVD que no tenga la API de Google Play, o uno rooteado con aplicaciones como Magisk y RootAVD.</p>
<p><a href="https://github.com/frida/frida/releases">&mdash;&gt; Descargar Frida desde Github &lt;&mdash;</a></p>
<p>Una vez descargada la versión de nuestra preferencia (Yo usé la 16.x), lo subimos a alguna ruta cómoda para trabajar, como <code>/data/local/tmp</code> y lo ejecutamos, puede ser en segundo plano -o no- , ya saben, dando permisos de ejecución y listo:</p>
<p><code>chmod +x ./frida-server*</code> y <code>./frida-server*</code></p>
<p>Una vez listo el servidor y corriendo, podríamos empezar a hookear procesos, para este ejemplo particular me decidí por trabajar con un reto sencillo de Hack the Box llamado Pinned, pero puede ser realmente cualquier APK, el objetivo no es resolver el reto en sí, sino entender cómo funciona frida y aprender a craftear nuestros scripts personalizados. Nota: tener bases en reversing (de binarios ELF o SAST puede ayudar a interiorizar mejor el contenido de este artículo, pero realmente <strong>no es indispensable</strong>).</p>
<p>Una vez que tenemos iniciada la APK a analizar, tenemos que encontrar el identificador de proceso al que Frida se adjuntará (attach), esto puede hacerse con <code>frida-ps -U</code> y para filtrar por el proceso que nos interesa, podemos usar algún grep case insensitive, quedándonos tal que así: <code>frida-ps -U | grep -i &lt;APP&gt;</code>. Con lo anterior preparado, vamos ahora sí a lo que nos interesa: hooking!</p>
<p>Una última cosa, para cargar nuestros scripts al proceso (nótese que no estoy diciendo inyectar) podemos usar el comando <code>frida -U -p &lt;PID&gt; -l &lt;SCRIPT&gt;</code>.</p>
<hr>
<h2 id="qué-quéremos-lograr-con-nuestro-script">¿Qué quéremos lograr con nuestro script?<a href="#qué-quéremos-lograr-con-nuestro-script" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Una vez que tenemos la posibilidad de cargar nuestros scripts y tal, nos viene a la mente la duda: ¿Cómo sabemos qué script queremos para según qué app? bueno, pues la respuesta es: depende de qué querramos lograr. en mi caso, quise intentar entender paso a paso el código, e identificando las funciones de interés que se ejecutaban, procedí a hookearlas, agregando un mensaje casero de debug:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">available</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {});
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Mi lógica de scripting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>El anterior no es más que el esqueleto que usaremos para trabajar, indica si el JVM (El entorno en tiempo de ejecución) está listo para que podamos empezar a trabajar. Para manipular el flujo de la aplicación -como dice el párrafo anterior- necesitamos tener en claro qué queremos lograr, en nuestro objetivo inicial será entender cómo funciona la aplicación, previamente podemos leer el código con herramientas como <code>jadx-gui</code>, pero manteniéndonos en las bases: ¿Cómo le indicamos a frida qué función, variable u objeto queremos manipular?</p>
<p>Toda aplicación de Android tiene una clase MainActivity, y para este caso, la manera de indicar que queremos usar la clase MainActivity es la siguiente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">available</span>){
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span>(){
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Aquí metí un mensaje para asegurarnos que configuramos todo bien
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] Frida funciona!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MainActivity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.example.pinned.MainActivity&#34;</span>);
</span></span><span style="display:flex;"><span>	);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>De esta manera, podemos trabajar con las funciones que estén dentro de esta clase, en este caso vemos la función <code>w()</code>:
Primero, pongamos un mensaje casero de debugg cuando la función <code>w()</code> se active.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">available</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] Frida funciona!&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mainActivity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;com.example.pinned.MainActivity&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Copiamos la función original
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wOriginal</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mainActivity</span>.<span style="color:#a6e22e">w</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mainActivity</span>.<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//metemos la lógica deseada
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] funcion w hookeada con exito!&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// enviamos la función original como estaba
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wOriginal</span>.<span style="color:#a6e22e">call</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Entonces cada que hagamos alguna acción en la App que ejecute dicha función, nos imprimirá en consola que se hookeó, la razón por la que escogí primero esa función es para que entendamos algo importante más adelante.</p>
<hr>
<h2 id="inspeccionando-variables-internas">Inspeccionando variables internas<a href="#inspeccionando-variables-internas" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Para empezar, un contexto, la siguiente es una imagen de la misma clase MainActivity, que instancia diferentes variables:</p>

<img src="https://albertnath.github.io/hfc-blog/img/Del_hook_a_la_evasion_con_Frida/20250727141406.png"  alt="img1"  class="center"    />


<p>Podemos leer variables internas de la siguiente manera, a continuación digamos un ejemplo para la variable o, que mañosamente escogí porque entre todas, es un String:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] Valor original de o:&#34;</span>, <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">value</span>);
</span></span></code></pre></div><p>y así con cualuier valor, ahora, ¿Podemos modificarlas? pero claro que sí, podemos hacer todo eso y más, con algo como:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;java.lang.String&#34;</span>).<span style="color:#a6e22e">$new</span>(<span style="color:#e6db74">&#34;Hola mundo&#34;</span>);
</span></span></code></pre></div><p>En el código anterior cambiamos lo que séa que valga o, por &ldquo;Hola mundo&rdquo;, preguntota, ¿Esto funciona para cualquier variable?, respuesta corta: no.
Aquí el primer obstáculo. — <strong>no todo puede reemplazarse así</strong>. Por ejemplo, si <code>this.p</code> es un <code>java.security.cert.Certificate</code>, no podemos meterle un <code>String</code>. Los tipos deben ser compatibles o usar <code>null</code> si el objetivo es forzar un fallo.</p>
<p>El siguiente es un ejemplo de lo que ocurre si tenemos alguna inconsistencia al tratar de modificar variables con tipos de datos:</p>

<img src="https://albertnath.github.io/hfc-blog/img/Del_hook_a_la_evasion_con_Frida/20250727141831.png"  alt="img1"  class="center"    />


<p>La salida muestra que la función w se hookea, (ya vimos como poner eso) pero algo pasa al tratar de imprimir un valor, si prestamos atención, notaremos que menciona que es un tipo de dato Certificate, en otras palabras, es el certificado bajo el cual se comunica con alguna API, y abajo lo confirmamos, donde además tenemos la URL y algunos headers, ojo, pareciera que lo que está ahí es la contraseña, y si leemos el código sabremos que sí es, pero para resolver el reto, debemos -en teoría- ser capaces de interceptar esta petición para obtener la bandera, pero SPOILER: el SSL Pinning nos bloquea.</p>

<img src="https://albertnath.github.io/hfc-blog/img/Del_hook_a_la_evasion_con_Frida/20250727141255.png"  alt="img1"  class="center"    />


<hr>
<h2 id="ssl-pinning-en-pocas-palabras-y-cómo-nos-vale">SSL Pinning en pocas palabras (Y cómo nos vale)<a href="#ssl-pinning-en-pocas-palabras-y-cómo-nos-vale" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Es un mecanismo que fija certificados de confianza en una aplicación, como medida contra los ataques de Man-in-the-Middle (MiTM), pero como tenemos frida y podemos modificar valores en tiempo de ejecución, eso no nos interesa, tenemos información suficiente.</p>
<p>En muchas apps, el método que carga el certificado es algo como:</p>
<p><code>this.p = CertificateFactory.getInstance(&quot;X.509&quot;).generateCertificate(getResources().openRawResource(R.raw.certificate));</code></p>
<p>Y ese certificado se inyecta luego en un <code>SSLContext</code>. (¿UN QUÉ?)</p>
<p><strong>SSLContext:</strong></p>
<blockquote>
<p>Es el encargado de decidir <strong>en qué certificados confiar</strong> cuando se conecta por HTTPS.<br>
Si le das un certificado &ldquo;duro&rdquo; (como el que la app trae embebido), entonces <strong>solo aceptará ese</strong>.<br>
Pero si tú le cambias el <code>SSLContext</code> por uno que acepta todo&hellip; ¡la app confía en cualquiera! (como Burp o tu propio proxy malicioso).</p></blockquote>
<p>Entonces nuestra lógica debería quedar algo como:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">MainActivity</span>.<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] Bypass de SSL Pinning activado&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Opcional: Setear valores falsos o nulos
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">p</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Omitimos lógica original
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span></code></pre></div><p>Eso o hacer que el método no haga nada, pero devuelva el control sin errores.</p>
<p>Finalmente, usando todo lo anterior, y con un poco de recursos sobre cuáles son y cómo encontrar las clases encargadas de todo este proceso, metemos una política de lo más laxa y que permita todos los certificados (incluso si son nulos).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">available</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;[+] Iniciando hook de SSL Pinning&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">SSLContext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;javax.net.ssl.SSLContext&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">TrustManager</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;javax.net.ssl.X509TrustManager&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">HttpsURLConnection</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;javax.net.ssl.HttpsURLConnection&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">TrustAllManager</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">registerClass</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;hfc.lorne.TrustAllCerts&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">implements</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">TrustManager</span>],
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">checkClientTrusted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">chain</span>, <span style="color:#a6e22e">authType</span>) {},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">checkServerTrusted</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">chain</span>, <span style="color:#a6e22e">authType</span>) {},
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">getAcceptedIssuers</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> [];
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">trustManagers</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">array</span>(<span style="color:#e6db74">&#34;javax.net.ssl.TrustManager&#34;</span>, [
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">TrustAllManager</span>.<span style="color:#a6e22e">$new</span>(),
</span></span><span style="display:flex;"><span>    ]);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sslContext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">SSLContext</span>.<span style="color:#a6e22e">getInstance</span>(<span style="color:#e6db74">&#34;TLS&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sslContext</span>.<span style="color:#a6e22e">init</span>(<span style="color:#66d9ef">null</span>, <span style="color:#a6e22e">trustManagers</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Hook global (más efectivo)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">HttpsURLConnection</span>.<span style="color:#a6e22e">setDefaultSSLSocketFactory</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">sslContext</span>.<span style="color:#a6e22e">getSocketFactory</span>(),
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Hook SSLContext.init por si alguna clase lo usa directamente
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">SSLContext</span>.<span style="color:#a6e22e">init</span>.<span style="color:#a6e22e">overload</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;[Ljavax.net.ssl.KeyManager;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;[Ljavax.net.ssl.TrustManager;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;java.security.SecureRandom&#34;</span>,
</span></span><span style="display:flex;"><span>    ).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">c</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;[*] Interceptado SSLContext.init(), forzando TrustManager inseguro...&#34;</span>,
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">trustManagers</span>, <span style="color:#a6e22e">c</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;[+] Bypass aplicado. Todos los certificados serán confiables.&#34;</span>,
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Y una vez cargado nuestro script, tenemos evasión de SSL Pinning, somos capaces de interceptar y leer las peticiones realizadas, entre las cuales obtenemos la bandera de este reto.</p>

<img src="https://albertnath.github.io/hfc-blog/img/Del_hook_a_la_evasion_con_Frida/20250727140649.png"  alt="img1"  class="center"    />


<hr>
<h2 id="conclusión">Conclusión<a href="#conclusión" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Hookear funciones con frida no es nada dificil, y crear scripts personalizados tampoco, bueno, puede resultar complejo al principio, pero no toma mucho tiempo entender qué pasa por detrás, de manera que podemos anular las lógicas de seguridad, tanto como la que vimos, como controles de seguridad biométricos, detección de root, en fin&hellip;</p>
<p>Este flujo que comienza con <code>console.log(&quot;Frida funciona!&quot;)</code> y termina aceptando todos los certificados de una app demuestra que aprender Frida es una herramienta imprescindible para cualquier pentester móvil que busque entender a profundidad las aplicaciones que audita.</p>
<p>Los reto a hacer su propia versión del script, creando su propio certificado, y a explorar cómo hookear actividades dinámicamente cuando se lanzan en diferentes pantallas, entendiendo esto.</p>
<p>@Lorne (PD: el eMAPT está blandito, con esto ya tienen suficiente para la parte práctica, suerte!)</p>
<hr>
<h2 id="y-ya">¿Y ya?<a href="#y-ya" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Bueno, plot twist, mientras realizaba este artículo y jugaba con frida, mediante la técnica más básica, fui capaz de evadir más allá de la lógica de seguridad del SSL, obteniendo la bandera incluso antes de enviarse (client-side issues).</p>

<img src="https://albertnath.github.io/hfc-blog/img/Del_hook_a_la_evasion_con_Frida/20250727142425.png"  alt="img1"  class="center"    />


<p><strong>**</strong> Mientras intentaba modificar el valor de la variable <code>o</code>, fui capaz de leer el valor de la misma, que contenía la bandera (tal como en la petición). <strong>***</strong></p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Más posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
    
    
      <a href="https://albertnath.github.io/hfc-blog/posts/nahamcon_ctf_2025_infinite_queue/" class="button inline next">
         [<span class="button__text">NahamCon CTF 2025 | Infinite Queue</span>] &gt;
      </a>
    
  </div>
</div>


  

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="https://albertnath.github.io/hfc-blog/bundle.min.js"></script>





  
</div>

</body>
</html>
